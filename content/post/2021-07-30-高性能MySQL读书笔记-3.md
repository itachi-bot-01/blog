---
title: 《高性能MySQL》读书笔记-3-Schema与数据类型优化2
categories: [ Technology]
date: 2021-07-30T00:00:00+08:00
description: 《高性能MySQL》读书笔记-3-Schema与数据类型优化2
tags: [高性能MySQL,读书笔记]
url: /post/high-performance-mysql-3.html
---





第四章 Schema与数据类型优化的第二篇笔记。 

## 2. MySQL schema设计陷阱

#### 2.1 太多的列

MySQL的存储引擎API工作时需要在核心服务层和存储引擎层之间通过行缓冲格式拷贝数据，然后在核心服务中将缓冲内容解码成各个列，这个转换过程代价很高。

#### 2.2 太多的关联

所谓的”实体-属性-值“(EAV)设计模式是一个糟糕的设计模式。MySQL规定每个关联操作最多61张表，但是EAV需要很多自关联，实际上，太多关联时解析和优化的代价也会成为MySQL的性能问题。

#### 2.3 全能的枚举

注意防止使用过多枚举，一般情况下不要使用枚举。

#### 2.4 非此发明(not invent here)的NULL

一般情况字段值不推荐位null，即使需要事实上的空值时也不一定非要使用null，可以使用0或者没一个特殊值。但是确实需要null值时也不要害怕使用null。

## 3. 范式和反范式

写密集的场景下，范式化设计schema会有不错的效果:

* 范式化的更新操作通常比反范式要快
* 数据较好的范式化时，只有很少或者没有重复数据，修改的数据会更少
* 范式化的表通常更小，操作会更快
* 很少的冗余，意味着检索时更少需要distinct或者group by与语句

范式化缺点：范式化设计的表通常需要很多关联，这不仅代价昂贵，也可能导致索引失效。范式可能会将同属一个索引的列分散到不同的表中。

反范式的schema数据都在一张表里，可以很好的避免关联。实际项目开发时经常混用范式和反范式。但这其中需要平衡更新和查询的频率来设计schema

## 4. 缓存表和汇总表

